package lab.cgcl.dao;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;

import javax.sql.DataSource;

import org.apache.commons.beanutils.BeanUtils;

/**
 * retrieve 和 list 都返回beans
 * @author Administrator
 *
 */
public class SqlDaoWithBean extends SqlDaoImpl{

	public SqlDaoWithBean(DataSource dataSource) {
		super(dataSource);
	}
	
	public <T> ArrayList<T> list (String sql , Class<T> clazz) throws Exception{
		Connection con = dataSource.getConnection();
		Statement stmt =  con.createStatement();
		ArrayList<T> rlist = new ArrayList<T>();
		try {
			ResultSet rset = stmt.executeQuery(sql);
			while (rset.next()) {
				//Map<String ,String > res = new HashMap<String , String>();
				T result = clazz.newInstance();
				for (int i = 1 ; i  <= rset.getMetaData().getColumnCount() ; i ++) {
					BeanUtils.setProperty(result, rset.getMetaData().getColumnName(i),
							rset.getString(i));
					//res.put(rset.getMetaData().getColumnName(i) , rset.getString(i) );
				}
				rlist.add(result);
			}
		}finally {
			con.close();
		}
		return rlist;
	}
	
	public <T> T retrieve (String sql, Class<T> clazz) throws Exception{ 
		Connection con = dataSource.getConnection();
		Statement stmt =  con.createStatement();
		T result = clazz.newInstance();
		try {
			ResultSet rset = stmt.executeQuery(sql);
			if (rset.next()) {
				for (int i = 1 ; i  <= rset.getMetaData().getColumnCount() ; i ++) {
					BeanUtils.setProperty(result, rset.getMetaData().getColumnName(i),
							rset.getString(i));
				}
			}
		}finally {
			con.close();
		}
		
		return result;
	}
	

}
