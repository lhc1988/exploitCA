package lab.cgcl.requestClient;

import java.util.ArrayList;
import java.util.List;

import lab.cgcl.CAcrawler.domain.Product;
import lab.cgcl.dao.SqlDao;
import lab.cgcl.dao.SqlDaoWithBean;

import org.apache.http.message.BasicNameValuePair;
import org.apache.log4j.Logger;

public class BuildProductParameter {
	
	Logger log = Logger.getLogger(BuildProductParameter.class);
	
	private SqlDao dao;
	
	public SqlDao getDao() {
		return dao;
	}


	public void setDao(SqlDao dao) {
		this.dao = dao;
	}

	public List<List<BasicNameValuePair>> generateParameter (int index ) {
		List<List<BasicNameValuePair>> content = new ArrayList<List<BasicNameValuePair>> ();
		List<Product> products = getProduct(index , 10) ;
		for (Product product : products) {
			content.add(buildShareParameter(product));
		}
		return content;
	}

	private List<BasicNameValuePair> buildShareParameter(Product product) {
		List<BasicNameValuePair> paramList = new ArrayList<BasicNameValuePair> ();
    	paramList.add(new BasicNameValuePair("action", "SOCIALSHARE"));
    	paramList.add(new BasicNameValuePair("shareType", "SinaShare"));
    	paramList.add(new BasicNameValuePair("shareLocation", product.toString()));
    	return paramList;
    }
	
	private List<Product> getProduct (int index , int num){
		int offset = index + num ;
		String sql = "select * from causer.product limit " + index + " , " +  offset;
		List<Product> result = null ;
		try {
			result = ((SqlDaoWithBean)dao).list(sql , Product.class);
		} catch (Exception e) {
			log.error(e);
		}
		return result;
		
	}
}
